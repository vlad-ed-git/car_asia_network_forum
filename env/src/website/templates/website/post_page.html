{% extends 'base.html' %}
{% load static %}
{% block meta %}
<title>{{ post.title }}</title>
{% endblock %}

{% block content %}
{% load i18n %}

{% load comments %}
<div class="container-fluid py-5">
    <div class="row">
        <div class="col-12 offset-lg-1 col-lg-10">
            <div class="card shadow">
                <div class="card-body px-3 py-3">
                    <h5 class="py-0 headingFont colorBlack text-left">
                        {{ post.title }}
                    </h5>
                    
                    {% if post.featured_image %}
                    <div class="my-3 text-center">
                        <!-- featured image -->
                            <img class="img-fluid" src="{{ post.featured_image.url }}">
                    </div>
                    {% endif %}
                        
                    
                    <p class="bodyFont colorBlack maintainNewLines py-0">
                        {{ post.body|safe }}
                    </p>

                    <div>
                        {% include 'website/snippets/carousel.html' with post=post idCounter=1%}
                    </div>

                    <div>
                        {% trans "Posted by" %}
                        <span class="lightFont lightText">
                            <a href="{% url 'authors_posts' posts_by_author=post.author.id post_type='topic'%}" class="unstyled-link-colorBlack accentOnHover headingFont">
                            {% if is_my_post %}
                            {% trans "me" %}
                            {% else %}
                            {{ post.author.display_name }}
                            {% endif %}
                            </a>
                        </span>
                        <span class="pl-4 lightFont lightText colorDarkGrey">
                            {{ post.date_updated }}
                        </span>
                    </div>

                    <div class="my-3">
                        <span class="lightFont lightText mr-2">
                          <a href="{% url 'category_posts' post_type='topic' category=post.category %}" class="unstyled-link-colorAccent darkGreyOnHover headingFont">{{ post.get_category_display }}</a>
                        </span>
                        {% if post.tags %}
                        <span class="lightFont lightText colorAccent" id="post_tags">
                           {{ post.tags }}
                        </span>
                        {% endif %}
                    </div>
                    
                 

                    <div class="my-3">
                        <!--IF USER IS LOGGED IN -->
                        {% if request.user.is_authenticated %}

                         <!--IF POST IS TOPIC -->
                         {% if post_type == 'topic' %}

                        <!-- number of comments -->
                       <span class="colorBlack headingFont pr-3">
                           {% get_comment_count for post as comment_count %}
                           {{ comment_count }} {% trans "comment" %}{{ comment_count|pluralize }}
                       </span>

                        <!-- LIKE BUTTPN -->
                                <a href="{% url 'like_post' slug=post.slug post_type=post_type %}" 

                                {% if user_likes_post %}
                                class="mr-4 unstyled-link-colorAccent darkGreyOnHover headingFont"
                                {% else %}
                                class="mr-4 unstyled-link-colorDarkGrey accentOnHover headingFont"
                                {% endif %}
                                >
                                    {% include 'website/icons/thumbs_up.html' %}
                                    {% trans "Like" %}
                                </a>
                        <!-- DISLIKE BUTTON -->
                                <a href="{% url 'dislike_post' slug=post.slug post_type=post_type %}" 
                                {% if user_dislikes_post %}
                                class="mr-4 unstyled-link-colorAccent darkGreyOnHover headingFont"
                                {% else %}
                                class="mr-4 unstyled-link-colorDarkGrey accentOnHover headingFont"
                                {% endif %}
                                >
                                    {% include 'website/icons/thumbs_down.html' %}
                                    {% trans "Dislike" %}
                                </a>

                        {% endif %}
                        <!--END IF POST IS TOPIC -->

                        <!-- can edit or delete -->
                        {% if is_my_post %}
                        <a {% if post_type == 'topic' %} href="{% url 'topic:edit_topic' slug=post.slug %}" {% endif %}
                            class="unstyled-link-colorDarkGrey accentOnHover headingFont mr-4">
                            {% include 'website/icons/edit.html' %} {% trans "Edit" %}
                        </a>

                        <a {% if post_type == 'topic' %}
                            href="{% url 'topic:delete_topic' slug=post.slug redirect_to='topic:my_topics' %}" {% endif %}
                            class="unstyled-link-colorDarkGrey errorsOnHover headingFont mr-4">
                            {% include 'website/icons/delete.html' %} {% trans "Delete" %}
                        </a>
                        {% endif %}


                        <!--IF POST IS TOPIC show comment form -->
                        {% if post_type == 'topic' %}
                        <div class="d-block my-3">
                            {% render_comment_form for post %}
                        </div>
                        {% endif %}

                        <!--END IF USER IS LOGGED IN -->
                        {% else %}
                        <!-- USER IS NOT LOGGED IN -->
                        <a class="btn btnOutlineAccent headingFont w-100" href="{% url 'login' %}">{% trans "Login to comment on this thread" %}</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- COMMENTS SECTION -->
<!--IF POST IS TOPIC -->
{% if post_type == 'topic' %}
    <!--display comments -->
    {% include 'comments/topic/topic_comments.html' with post=post %}
{% endif %}
{% endblock content %}

{% block js %}
<!-- page specific javascript-->
<script src="{% static 'scripts/make_tags_clickable.js' %}"></script>
{% endblock js %}